# vim: filetype=bash

export BAZSHD=~/.bazsh.d
export BAZSHLIB=~/.bazsh.d/lib

export PATH=~/.bazsh.d/bin:${PATH}

export    _OS_=$(uname -s)
export _SHELL_=$(echo $SHELL | awk -F/ '{print $NF}')

ifshell(){
  if [ -n "$1" ] && [ $1 = $_SHELL_ ] ; then
    shift
    "$@"
  fi
} # ifshell

alias ifbash="ifshell bash"
alias  ifzsh="ifshell zsh"

case $_OS_ in
  Darwin)
    export _ETC_=/etc

    # Key bindings
    bindkey "^U" backward-kill-line # Ctrl-U

    test -d ${HOMEBREW_PREFIX}/opt/ruby/bin && \
    PATH=${_}:${PATH}
    export PATH

    test -d ~/Library/Python && \
    test -d ${_}/$(ls $_ | sort -nr | head -n1)/bin && \
    PATH=${_}:${PATH}
    export PATH

    # Podman and Docker interop
    test -f ~/.local/share/containers/podman/machine/qemu/podman.sock && \
    export DOCKER_HOST="unix://${_}"
    ;;

  FreeBSD)
    export _ETC_=/usr/local/etc
    ;;

  Linux)
    export _ETC_=/etc
    ;;

  SunOS)
    export _ETC_=/etc
    ;;
esac

. ${_ETC_}/bazshrc

test -d ~/.cargo/bin && PATH=${_}:${PATH} ; export PATH
test -d ~/go/bin     && PATH=${_}:${PATH} ; export PATH
test -d ~/bin        && PATH=${_}:${PATH} ; export PATH

test -f ~/.bazsh.d/alias/alias.sh         && . $_
test -f ~/.bazsh.d/alias/alias_${_OS_}.sh && . $_

test -d ~/.bazsh.d/func            && ls ${_}/*.sh | while read f ; do . $f ; done
test -d ~/.bazsh.d/func/${_OS_}    && ls ${_}/*.sh | while read f ; do . $f ; done
test -d ~/.bazsh.d/func/${_SHELL_} && ls ${_}/*.sh | while read f ; do . $f ; done

test -f ~/.bazsh.d/custom.sh && . $_
test -f ~/.${_SHELL_}rc_work && . $_
test -f ~/.${_SHELL_}rc_priv && . $_

